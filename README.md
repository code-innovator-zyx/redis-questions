# 								Redis 常见知识点

## 1. redis 到底是单线程还是多线程   [(这篇文章讲的非常详细)](https://blog.51cto.com/u_16099322/6451851#:~:text=Redis%20%E6%97%A2%E7%84%B6%E6%98%AF%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%9A%84%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E8%BF%99%E4%B9%88%E5%BF%AB%EF%BC%9F%201%20%E5%9F%BA%E4%BA%8E%E5%86%85%E5%AD%98%E6%93%8D%E4%BD%9C%EF%BC%9ARedis%20%E7%9A%84%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE%E9%83%BD%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%EF%BC%8C%E5%9B%A0%E6%AD%A4%E6%89%80%E6%9C%89%E7%9A%84%E8%BF%90%E7%AE%97%E9%83%BD%E6%98%AF%E5%86%85%E5%AD%98%E7%BA%A7%E5%88%AB%E7%9A%84%EF%BC%8C%E6%89%80%E4%BB%A5%E5%AE%83%E7%9A%84%E6%80%A7%E8%83%BD%E6%AF%94%E8%BE%83%E9%AB%98%202%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%AE%80%E5%8D%95%EF%BC%9ARedis%20%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%98%AF%E4%B8%BA%E8%87%AA%E8%BA%AB%E4%B8%93%E9%97%A8%E9%87%8F%E8%BA%AB%E6%89%93%E9%80%A0%E7%9A%84%EF%BC%8C%E8%80%8C%E8%BF%99%E4%BA%9B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%9A%84%E6%9F%A5%E6%89%BE%E5%92%8C%E6%93%8D%E4%BD%9C%E7%9A%84%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6%E9%83%BD%E6%98%AF,socket%20%E8%BF%9E%E6%8E%A5%E5%AE%A2%E6%88%B7%E7%AB%AF%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B%E6%9D%A5%E5%A4%84%E7%90%86%E5%A4%9A%E4%B8%AA%E6%83%85%E5%86%B5%EF%BC%8C%E4%BB%8E%E8%80%8C%E5%87%8F%E5%B0%91%E7%BA%BF%E7%A8%8B%E5%88%87%E6%8D%A2%E5%B8%A6%E6%9D%A5%E7%9A%84%E5%BC%80%E9%94%80%EF%BC%8C%E5%90%8C%E6%97%B6%E4%B9%9F%E9%81%BF%E5%85%8D%E4%BA%86%20I%2FO%20%E9%98%BB%E5%A1%9E%E6%93%8D%E4%BD%9C%EF%BC%8C%E4%BB%8E%E8%80%8C%E5%A4%A7%E5%A4%A7%E5%9C%B0%E6%8F%90%E9%AB%98%E4%BA%86%20Redis%20%E7%9A%84%E6%80%A7%E8%83%BD%204%20%E9%81%BF%E5%85%8D%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2%EF%BC%9A%E5%9B%A0%E4%B8%BA%E6%98%AF%E5%8D%95%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B%EF%BC%8C%E5%9B%A0%E6%AD%A4%E5%B0%B1%E9%81%BF%E5%85%8D%E4%BA%86%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2%E5%92%8C%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%AB%9E%E4%BA%89%EF%BC%8C%E8%BF%99%E5%B0%B1%E7%9C%81%E5%8E%BB%E4%BA%86%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%88%87%E6%8D%A2%E5%B8%A6%E6%9D%A5%E7%9A%84%E6%97%B6%E9%97%B4%E5%92%8C%E6%80%A7%E8%83%BD%E4%B8%8A%E7%9A%84%E5%BC%80%E9%94%80%EF%BC%8C%E8%80%8C%E4%B8%94%E5%8D%95%E7%BA%BF%E7%A8%8B%E4%B8%8D%E4%BC%9A%E5%AF%BC%E8%87%B4%E6%AD%BB%E9%94%81%E7%9A%84%E9%97%AE%E9%A2%98%E5%8F%91%E7%94%9F)

``````apl
	redis 版本有很多，如果不限定版本来问redis是否单线程其实食不严谨的：
		· 4.0之前的版本,就是我们常说的单线程redis
		· 4.0及之后的版本可以说是多线程的了，虽然redis对外提供的键值存储服务的主要流程是单线程，也就是网络IO和数据读写是由单个线程来完成的。但是除此之外的redis其他功能，比如持久化、异步删除、集群数据同步等，都是由额外的线程来执行的。
		· 6.x + & 7.x +,告别了大家印象中的单线程了，引入了全新的多线程来解决问题，将网络数据读写、请求协议解析通过多个IO线程的来处理 ，但是真正的命令执行任然使用主线程执行，保证数据线程安全。
``````



## 2. redis 单线程为什么还能这么快

``````apl
在redis 4.0 之前，redis 是单线程运行的，主要有以下三点原因：
	· 使用单线程模式的redis，开发和维护更加简单
	· 即使使用单线程模型也能够并发的处理多个客户端的请求，因为底层使用了基于epoll的多路复用
	· 对于redis而言，主要的性能瓶颈在于机器的内存、网络带宽，而不是CPU。

为什么单线程速度还能这么快哪？吞吐量还能那么高？
原因主要有以下几点：
	· 基于内存操作：redis的所有数据都在内存中，因此所有的运算都是内存级别的
	· 数据结构简单：redis的数据结构都是为自身专门量身打造的，类似于HashMap 而这些数据结构的查找和操作的时间复杂度都是O(1)
	· 多路复用和非阻塞I/O：redis使用I/O多路复用功能来监听多个socket连接客户端，这样就可以一个线程来处理多个客户端的请求，从而减少线程切换带来的开销，同时也避免了I/O阻塞操作，从而大大地提高了redis的性能
	· 避免上下文切换：因为是单线程模型，因此就避免了不必要的上下文切换和多线程竞争，这就省去了多线程切换带来的时间和性能上的开销，而且线程不会导致死锁的问题发生
	
``````



## 3. redis 中非阻塞I/O和I/O多路复用是什么

![文件事件处理器](https://img-blog.csdnimg.cn/img_convert/826a9f0d2d9ea25d6c854d4b0b236df5.png)

``````apl
	redis 之所以单线程也这么快，基于事件驱动的 epoll多路复用功不可没。
		· 文件事件处理器使用I/O多路复用(multiplexing)同时监听多个套接字，并根据套接字目前执行的任务为套接字关联不同的事件处理器
		· 当监听套接字准备好执行应答(accept)、读取(read)、写入(write)、关闭(close)等操作时，与操作所对应的文件事件就会产生，文件事件处理器就会调用套接字之前关联好的事件处理器来处理这些事件
	事件处理器是单线程的，但是通过I/O多路复用同时监听多个套接字文件时期处理器既实现了高性能网络通讯模型，有保证了内部单线程设计的简单性
	
举个例子：
	假如餐厅只有一个服务员，同时来了多个客人，服务员有以下三种接待方式：
		1. 顺序的接待客人，当一个客人点好餐再去下一个客人餐桌接待。(如果客人还没想好吃什么，犹犹豫豫，就要一直等着，直到点餐完毕)
		2. 不停地在多个客人餐桌来回询问点什么餐？（频繁的切换上下文）
		3. 每个餐桌上有菜单，客人点好餐就call一声，服务员就过去拿餐单（基于事件的驱动）
第三中就是我们所说的io/多路复用模型
``````

## 4. 聊一聊6.0中的多线程

``````apl
	4.0 版本开始引入多线程，但是此版本的多线程主要用于大数据量的删除，对于非删除操作的意义并不是很大。
	Redis 6.0是为了提高I/0的读写性能引入的，它的主要实现思路是将主线程的I/O读写任务拆分给一组独立的子线程去执行，也就是说从socket中读数据和写数据不再由主线程负责，而是交给了多个子线程，这样就可以使多个socket的读写并行化了。这么做的原因是因为，虽然在redis中使用了i/o多路复用和非阻塞i/o，但是我们都知道数据在内核态空间和用户态空间之间的拷贝是无法避免的，而数据的拷贝是阻塞的，并且数据量越大，拷贝所需要的时间就越多。
	
	
	redis多线程默认是关闭的,如何启用？
	修改 redis.conf中两个配置：
	io-thread-do-reads yes    # 开启子线程
	io-threads 3    # 设置子线程数量
	
	
``````



## 3. redis 底层数据是如何用跳表来存储的

## 4. redis key过期了为什么内存没有被释放

## 5. redis key没设置过期时间，为什么会被主动删除

## 6. redis 淘汰key的算法LRU和LFU的区别

## 7. 删除key的命令会阻塞redis吗

## 8. redis 主从、哨兵、集群结构优缺点比较

## 9. redis 集群数据hash分片算法是怎么回事？

## 10. redis 执行命令竟然有死循环阻塞Bug

## 11. 一次线上事故，redis主从切换导致了缓存雪崩

## 12. Redis 持久化机制

## 13. redis 持久化RDB,AOF,混合持久怎么回事？

## 14. 线上redis 持久化策略一般如何配置

## 15. 一次线上事故，redis主节点宕机导致数据全部丢失

## 16. redis线上数据如何备份

## 17. redis 主从复制风暴是怎么回事

## 18. redis集群网络抖动导致频繁主从切换怎么处理

## 19. redis集群为什么至少需要三个master节点

## 20. redis 集群为什么推荐奇数个节点

## 21. redis集群支持批量操作命令吗

## 22. Lua脚本能在redis集群里执行吗

## 23. redis 主从切换导致分布式锁丢失是什么问题

## 24. Redlock如何解决redis主从切换分布式锁丢失问题

## 25. 中小公司redis缓存架构以及线上问题分析

## 26. 大厂线上大规模商品缓存数据冷热分离实战

## 27. 实战解决大规模缓存击穿导致线上数据库压力暴增

## 28. 面试常问的缓存穿透是什么问题

## 29. 基于DCL机制解决突发性热点缓存并发重建问题实战

## 30. redis 分布式锁解决缓存与数据库双写不一致问题

## 31. 大促压力暴增导致分布式锁串行争用问题

## 32. 利用多级缓存架构解决redis线上集群缓存雪崩问题

## 33. redis过期键的删除策略

## 34. redis 分布式锁的底层是如何实现的

## 35. Redis 和mysql是如何保证数据一致性的

## 36. Redis 集群方案

## 37. redis 线程模型，单线程为什么这么快

## 38. redis 主从复制的核心原理

## 39. redis 有哪些数据结构？分别有哪些典型的应用场景

## 40. 布隆过滤器原理？优缺点

## 41. 常见的缓存淘汰算法

## 42. 缓存穿透，缓存击穿，缓存雪崩
